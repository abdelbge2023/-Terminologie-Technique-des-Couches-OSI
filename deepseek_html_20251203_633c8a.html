<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animation Flux R√©seau Client/Serveur</title>
    <style>
        :root {
            --client: #3b82f6;
            --server: #10b981;
            --router: #f59e0b;
            --switch: #8b5cf6;
            --layer7: #ef4444;
            --layer4: #3b82f6;
            --layer3: #10b981;
            --layer2: #f59e0b;
            --layer1: #8b5cf6;
            --dark: #0f172a;
            --light: #f8fafc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #0f172a 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px;
            margin-bottom: 40px;
            background: rgba(30, 41, 59, 0.9);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            background: linear-gradient(90deg, var(--client), var(--server));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .btn {
            background: var(--client);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-play { background: var(--client); }
        .btn-pause { background: var(--server); }
        .btn-reset { background: var(--router); }
        .btn-slow { background: #8b5cf6; }
        .btn-fast { background: #ec4899; }

        /* SC√àNE PRINCIPALE */
        .scene {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 40px;
            align-items: center;
            min-height: 600px;
            position: relative;
            padding: 40px;
            background: rgba(15, 23, 42, 0.7);
            border-radius: 20px;
            margin: 30px 0;
            overflow: hidden;
        }

        /* √âL√âMENTS DU R√âSEAU */
        .network-element {
            background: rgba(30, 41, 59, 0.9);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 3px solid;
            transition: all 0.3s;
        }

        .client { border-color: var(--client); }
        .server { border-color: var(--server); }
        .router { border-color: var(--router); width: 250px; margin: 0 auto; }
        .switch { border-color: var(--switch); width: 200px; margin: 20px auto; }

        .network-element.active {
            animation: pulse 2s infinite;
            box-shadow: 0 0 30px currentColor;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px currentColor; }
            50% { box-shadow: 0 0 40px currentColor; }
        }

        .element-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .element-details {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-family: 'Consolas', monospace;
            font-size: 0.9rem;
            text-align: left;
        }

        /* LIGNES DE CONNEXION */
        .connection-line {
            position: absolute;
            background: rgba(59, 130, 246, 0.3);
            height: 4px;
            transform-origin: left center;
            z-index: 1;
        }

        .connection-line.active {
            background: var(--client);
            animation: flowLine 2s linear infinite;
        }

        @keyframes flowLine {
            0% { background: var(--client); }
            50% { background: var(--server); }
            100% { background: var(--client); }
        }

        /* PAQUET EN MOUVEMENT */
        .packet {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, var(--client), var(--server));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.5s linear;
            cursor: pointer;
        }

        .packet:hover {
            transform: scale(1.2);
            z-index: 100;
        }

        .packet-layer {
            position: absolute;
            top: -25px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            white-space: nowrap;
            display: none;
        }

        .packet:hover .packet-layer {
            display: block;
        }

        /* VISUALISATION DES COUCHES */
        .layers-visualization {
            display: flex;
            gap: 10px;
            margin: 40px 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        .layer-box {
            width: 80px;
            height: 400px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 2px solid;
        }

        .layer-box.l7 { border-color: var(--layer7); }
        .layer-box.l6 { border-color: #7c3aed; }
        .layer-box.l5 { border-color: #6d28d9; }
        .layer-box.l4 { border-color: var(--layer4); }
        .layer-box.l3 { border-color: var(--layer3); }
        .layer-box.l2 { border-color: var(--layer2); }
        .layer-box.l1 { border-color: var(--layer1); }

        .layer-label {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .layer-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            min-height: 60px;
            font-family: 'Consolas', monospace;
            font-size: 0.8rem;
            overflow-y: auto;
        }

        .data-chunk {
            background: rgba(59, 130, 246, 0.3);
            margin: 5px 0;
            padding: 5px;
            border-radius: 5px;
            font-size: 0.7rem;
            word-break: break-all;
        }

        /* TERMINAL DE D√âBUG */
        .debug-terminal {
            background: #111827;
            color: #4ade80;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Consolas', monospace;
            margin: 30px 0;
            height: 300px;
            overflow-y: auto;
            border: 2px solid #374151;
        }

        .debug-line {
            margin: 5px 0;
            opacity: 0.8;
        }

        .debug-line.active {
            opacity: 1;
            color: #3b82f6;
            font-weight: bold;
        }

        /* PROGRESSION */
        .progress-container {
            margin: 30px 0;
            background: rgba(30, 41, 59, 0.8);
            padding: 20px;
            border-radius: 15px;
        }

        .progress-bar {
            height: 20px;
            background: #1f2937;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--client), var(--server));
            width: 0%;
            transition: width 0.3s;
            position: relative;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #9ca3af;
        }

        .step.active {
            color: var(--client);
            font-weight: bold;
        }

        /* MODAL D√âTAILS PAQUET */
        .packet-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #1e293b;
            padding: 40px;
            border-radius: 20px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ef4444;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
        }

        /* TIMELINE */
        .timeline {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 20px;
            margin: 30px 0;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
        }

        .timeline-step {
            min-width: 200px;
            background: rgba(59, 130, 246, 0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--client);
            opacity: 0.5;
            transition: all 0.3s;
        }

        .timeline-step.active {
            opacity: 1;
            background: rgba(59, 130, 246, 0.3);
            border-color: var(--server);
        }

        /* ANIMATIONS */
        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .flashing {
            animation: flash 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .bouncing {
            animation: bounce 0.5s infinite;
        }

        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .scene {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                gap: 20px;
            }
            
            .network-path {
                order: 2;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåê Animation Flux R√©seau Client ‚Üí Serveur</h1>
            <p>Visualisation interactive du trajet des donn√©es √† travers les 7 couches OSI</p>
            
            <div class="controls">
                <button class="btn btn-play" onclick="startAnimation()">
                    <span>‚ñ∂Ô∏è</span> D√©marrer
                </button>
                <button class="btn btn-pause" onclick="pauseAnimation()">
                    <span>‚è∏Ô∏è</span> Pause
                </button>
                <button class="btn btn-reset" onclick="resetAnimation()">
                    <span>üîÑ</span> R√©initialiser
                </button>
                <button class="btn btn-slow" onclick="setSpeed('slow')">
                    <span>üê¢</span> Lent
                </button>
                <button class="btn btn-fast" onclick="setSpeed('fast')">
                    <span>‚ö°</span> Rapide
                </button>
            </div>
        </header>

        <!-- PROGRESSION -->
        <div class="progress-container">
            <h3>üìä Progression de la Transmission</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-steps" id="progressSteps">
                <!-- Rempli par JavaScript -->
            </div>
        </div>

        <!-- SC√àNE PRINCIPALE -->
        <div class="scene" id="mainScene">
            <!-- CLIENT -->
            <div class="network-element client" id="clientElement">
                <div class="element-icon">üíª</div>
                <h3>Client</h3>
                <p>Navigateur Web</p>
                <div class="element-details">
                    IP: 192.168.1.100<br>
                    MAC: 00:11:22:33:44:55<br>
                    Port: 49152<br>
                    OS: Windows 10
                </div>
            </div>

            <!-- R√âSEAU -->
            <div class="network-path">
                <div class="router network-element" id="routerElement">
                    <div class="element-icon">üö¶</div>
                    <h3>Routeur</h3>
                    <p>192.168.1.1 ‚Üí Internet</p>
                    <div class="element-details">
                        Interface LAN: 192.168.1.1<br>
                        Interface WAN: 81.67.45.23<br>
                        NAT: Activ√©<br>
                        Firewall: Activ√©
                    </div>
                </div>

                <div class="switch network-element" id="switchElement">
                    <div class="element-icon">üîÄ</div>
                    <h3>Switch</h3>
                    <p>Commutation MAC</p>
                    <div class="element-details">
                        Ports: 8<br>
                        VLAN: 1<br>
                        MAC Table: Apprentissage
                    </div>
                </div>
            </div>

            <!-- SERVEUR -->
            <div class="network-element server" id="serverElement">
                <div class="element-icon">üñ•Ô∏è</div>
                <h3>Serveur Web</h3>
                <p>Apache sur Linux</p>
                <div class="element-details">
                    IP: 93.184.216.34<br>
                    MAC: 00:AA:BB:CC:DD:EE<br>
                    Port: 80 (HTTP)<br>
                    Service: example.com
                </div>
            </div>

            <!-- LIGNES DE CONNEXION -->
            <div class="connection-line" id="line1" style="width: 200px; left: 320px; top: 350px; transform: rotate(0deg);"></div>
            <div class="connection-line" id="line2" style="width: 200px; left: 520px; top: 350px; transform: rotate(0deg);"></div>
            <div class="connection-line" id="line3" style="width: 400px; left: 720px; top: 350px; transform: rotate(0deg);"></div>

            <!-- PAQUETS -->
            <div class="packet" id="packet1" style="left: 300px; top: 340px;">P1</div>
            <div class="packet" id="packet2" style="left: 300px; top: 340px; display: none;">P2</div>
        </div>

        <!-- VISUALISATION DES COUCHES -->
        <div class="layers-visualization" id="layersViz">
            <!-- Rempli par JavaScript -->
        </div>

        <!-- TERMINAL DE D√âBUG -->
        <div class="debug-terminal" id="debugTerminal">
            <div class="debug-line">$ Syst√®me initialis√©...</div>
            <div class="debug-line">$ Pr√™t pour simulation r√©seau</div>
            <div class="debug-line">$ Client: 192.168.1.100</div>
            <div class="debug-line">$ Serveur: 93.184.216.34:80</div>
            <div class="debug-line">$ Cliquez "D√©marrer" pour lancer l'animation</div>
        </div>

        <!-- TIMELINE -->
        <div class="timeline" id="timeline">
            <!-- Rempli par JavaScript -->
        </div>

        <!-- MODAL D√âTAILS -->
        <div class="packet-modal" id="packetModal">
            <div class="modal-content">
                <button class="close-modal" onclick="closeModal()">√ó</button>
                <h2>üì¶ Analyse du Paquet</h2>
                <div id="packetDetails"></div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURATION
        const config = {
            speed: 'normal',
            speeds: {
                slow: 2000,
                normal: 1000,
                fast: 500
            },
            animationStep: 0,
            totalSteps: 20,
            isPlaying: false,
            intervalId: null
        };

        // DONN√âES DE SIMULATION
        const simulationData = {
            steps: [
                {
                    name: "Requ√™te HTTP",
                    description: "L'utilisateur entre 'example.com' dans son navigateur",
                    layer: 7,
                    client: "GET / HTTP/1.1",
                    server: null
                },
                {
                    name: "Encapsulation TCP",
                    description: "Ajout de l'en-t√™te TCP avec ports source/destination",
                    layer: 4,
                    client: "Port 49152 ‚Üí 80",
                    server: null
                },
                {
                    name: "Encapsulation IP",
                    description: "Ajout des adresses IP source et destination",
                    layer: 3,
                    client: "IP: 192.168.1.100 ‚Üí 93.184.216.34",
                    server: null
                },
                {
                    name: "Encapsulation Ethernet",
                    description: "Ajout des adresses MAC",
                    layer: 2,
                    client: "MAC Client ‚Üí Routeur",
                    server: null
                },
                {
                    name: "Transmission Physique",
                    description: "Conversion en signaux √©lectriques",
                    layer: 1,
                    client: "Bits ‚Üí C√¢ble",
                    server: null
                },
                {
                    name: "Switch - Commutation",
                    description: "Le switch forwarde vers le routeur",
                    layer: 2,
                    client: null,
                    server: null,
                    network: "Switch: Forward bas√© sur MAC"
                },
                {
                    name: "Routeur - D√©capsulation",
                    description: "Le routeur d√©termine le prochain saut",
                    layer: 3,
                    client: null,
                    server: null,
                    network: "Routeur: V√©rification IP destination"
                },
                {
                    name: "Internet - Routage",
                    description: "Le paquet traverse Internet",
                    layer: 3,
                    client: null,
                    server: null,
                    network: "Travers√©e du r√©seau Internet"
                },
                {
                    name: "Serveur - R√©ception",
                    description: "Le serveur re√ßoit le paquet",
                    layer: 1,
                    client: null,
                    server: "R√©ception signaux √©lectriques"
                },
                {
                    name: "Serveur - D√©capsulation",
                    description: "D√©capsulation progressive",
                    layer: 2,
                    client: null,
                    server: "D√©capsulation Ethernet"
                },
                {
                    name: "Serveur - V√©rification IP",
                    description: "V√©rification adresse IP destination",
                    layer: 3,
                    client: null,
                    server: "V√©rification IP: 93.184.216.34"
                },
                {
                    name: "Serveur - V√©rification TCP",
                    description: "V√©rification port 80",
                    layer: 4,
                    client: null,
                    server: "Port 80 ‚Üí Processus Apache"
                },
                {
                    name: "Serveur - Traitement HTTP",
                    description: "Traitement de la requ√™te GET",
                    layer: 7,
                    client: null,
                    server: "Apache traite GET /"
                },
                {
                    name: "R√©ponse - Pr√©paration",
                    description: "Le serveur pr√©pare la r√©ponse",
                    layer: 7,
                    client: null,
                    server: "G√©n√©ration HTML"
                },
                {
                    name: "R√©ponse - Encapsulation",
                    description: "Encapsulation inverse",
                    layer: 4,
                    client: null,
                    server: "TCP: Port 80 ‚Üí 49152"
                },
                {
                    name: "R√©ponse - Transmission",
                    description: "Envoi de la r√©ponse",
                    layer: 1,
                    client: null,
                    server: "Transmission vers client"
                },
                {
                    name: "Client - R√©ception",
                    description: "Le client re√ßoit la r√©ponse",
                    layer: 1,
                    client: "R√©ception r√©ponse",
                    server: null
                },
                {
                    name: "Client - D√©capsulation",
                    description: "D√©capsulation progressive",
                    layer: 7,
                    client: "D√©capsulation HTTP",
                    server: null
                },
                {
                    name: "Client - Affichage",
                    description: "Affichage de la page web",
                    layer: 7,
                    client: "Rendu HTML dans navigateur",
                    server: null
                },
                {
                    name: "Terminaison",
                    description: "Fermeture propre de la connexion",
                    layer: 4,
                    client: "TCP FIN",
                    server: "TCP FIN-ACK"
                }
            ],
            
            packetStructure: {
                application: {
                    layer: 7,
                    data: "GET / HTTP/1.1\r\nHost: example.com\r\nUser-Agent: Mozilla/5.0",
                    size: "145 bytes"
                },
                transport: {
                    layer: 4,
                    data: "TCP Header\nSrc Port: 49152\nDst Port: 80\nSeq: 1000\nAck: 0\nFlags: SYN",
                    size: "20 bytes"
                },
                network: {
                    layer: 3,
                    data: "IP Header\nSrc: 192.168.1.100\nDst: 93.184.216.34\nTTL: 64\nProtocol: TCP",
                    size: "20 bytes"
                },
                dataLink: {
                    layer: 2,
                    data: "Ethernet Header\nDst MAC: 00:AA:BB:CC:DD:EE\nSrc MAC: 00:11:22:33:44:55\nType: 0x0800",
                    size: "14 bytes"
                }
            }
        };

        // INITIALISATION
        function init() {
            createLayersVisualization();
            createTimeline();
            createProgressSteps();
            setupPacketClick();
        }

        // CR√âATION VISUALISATION COUCHES
        function createLayersVisualization() {
            const layers = [
                { number: 7, name: "Application", color: "layer7", protocols: "HTTP, DNS, FTP" },
                { number: 6, name: "Pr√©sentation", color: "layer6", protocols: "SSL, JPEG, MPEG" },
                { number: 5, name: "Session", color: "layer5", protocols: "RPC, SIP, NetBIOS" },
                { number: 4, name: "Transport", color: "layer4", protocols: "TCP, UDP, Ports" },
                { number: 3, name: "R√©seau", color: "layer3", protocols: "IP, ICMP, ARP" },
                { number: 2, name: "Liaison", color: "layer2", protocols: "Ethernet, MAC, VLAN" },
                { number: 1, name: "Physique", color: "layer1", protocols: "C√¢bles, Bits, Signaux" }
            ];

            const container = document.getElementById('layersViz');
            container.innerHTML = '';
            
            layers.forEach(layer => {
                const div = document.createElement('div');
                div.className = `layer-box l${layer.number}`;
                div.id = `layer${layer.number}`;
                div.innerHTML = `
                    <div class="layer-label">L${layer.number}<br><small>${layer.name}</small></div>
                    <div class="layer-content" id="layer${layer.number}Content">
                        <div class="data-chunk">En attente...</div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // CR√âATION TIMELINE
        function createTimeline() {
            const container = document.getElementById('timeline');
            container.innerHTML = '';
            
            simulationData.steps.forEach((step, index) => {
                const div = document.createElement('div');
                div.className = 'timeline-step';
                div.id = `timelineStep${index}`;
                div.innerHTML = `
                    <strong>√âtape ${index + 1}</strong><br>
                    <small>${step.name}</small><br>
                    <span style="font-size: 0.8rem; color: #9ca3af;">${step.description}</span>
                `;
                container.appendChild(div);
            });
        }

        // CR√âATION √âTAPES DE PROGRESSION
        function createProgressSteps() {
            const container = document.getElementById('progressSteps');
            container.innerHTML = '';
            
            const steps = ['Client', 'Switch', 'Routeur', 'Internet', 'Serveur', 'Retour'];
            
            steps.forEach((step, index) => {
                const span = document.createElement('span');
                span.className = 'step';
                span.id = `progressStep${index}`;
                span.textContent = step;
                container.appendChild(span);
            });
        }

        // D√âMARRER L'ANIMATION
        function startAnimation() {
            if (config.isPlaying) return;
            
            config.isPlaying = true;
            logDebug("üöÄ Animation d√©marr√©e");
            
            // D√©sactiver bouton play
            document.querySelector('.btn-play').disabled = true;
            
            // Lancer l'animation √©tape par √©tape
            config.intervalId = setInterval(nextStep, config.speeds[config.speed]);
        }

        // √âTAPE SUIVANTE
        function nextStep() {
            if (config.animationStep >= config.totalSteps) {
                completeAnimation();
                return;
            }
            
            const step = simulationData.steps[config.animationStep];
            
            // Mettre √† jour l'interface
            updateProgress();
            updateTimeline();
            updateLayers(step);
            movePackets();
            highlightElements(step);
            logStep(step);
            
            config.animationStep++;
            
            // Mettre √† jour la barre de progression
            const progress = (config.animationStep / config.totalSteps) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        // METTRE √Ä JOUR LA PROGRESSION
        function updateProgress() {
            const steps = document.querySelectorAll('.step');
            const activeIndex = Math.floor((config.animationStep / config.totalSteps) * steps.length);
            
            steps.forEach((step, index) => {
                step.classList.remove('active');
                if (index <= activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // METTRE √Ä JOUR LA TIMELINE
        function updateTimeline() {
            const steps = document.querySelectorAll('.timeline-step');
            
            steps.forEach((step, index) => {
                step.classList.remove('active');
                if (index === config.animationStep) {
                    step.classList.add('active');
                    step.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                }
            });
        }

        // METTRE √Ä JOUR LES COUCHES
        function updateLayers(step) {
            const layerElement = document.getElementById(`layer${step.layer}`);
            const contentElement = document.getElementById(`layer${step.layer}Content`);
            
            if (layerElement && contentElement) {
                // Animation flash sur la couche active
                layerElement.classList.add('flashing');
                setTimeout(() => layerElement.classList.remove('flashing'), 1000);
                
                // Mettre √† jour le contenu
                let content = '';
                if (step.client) content = `‚Üí Client: ${step.client}`;
                if (step.server) content = `‚Üê Serveur: ${step.server}`;
                if (step.network) content = `‚Üî R√©seau: ${step.network}`;
                
                contentElement.innerHTML = `<div class="data-chunk">${content}</div>`;
            }
        }

        // D√âPLACER LES PAQUETS
        function movePackets() {
            const packet1 = document.getElementById('packet1');
            const packet2 = document.getElementById('packet2');
            const lines = ['line1', 'line2', 'line3'];
            
            // Calculer la position bas√©e sur l'√©tape
            const progress = config.animationStep / config.totalSteps;
            
            // D√©placer packet1 (requ√™te)
            if (progress < 0.6) {
                packet1.style.display = 'flex';
                const x = 300 + (progress * 1000);
                packet1.style.left = `${x}px`;
                
                // Activer la ligne correspondante
                const lineIndex = Math.floor(progress * 3);
                if (lineIndex < 3) {
                    document.getElementById(lines[lineIndex]).classList.add('active');
                }
            }
            
            // D√©placer packet2 (r√©ponse)
            if (progress >= 0.4 && progress < 1) {
                packet2.style.display = 'flex';
                const x = 1300 - ((progress - 0.4) * 1000);
                packet2.style.left = `${x}px`;
            }
            
            // Mettre √† jour le contenu des paquets
            updatePacketContent();
        }

        // METTRE √Ä JOUR CONTENU DES PAQUETS
        function updatePacketContent() {
            const packets = document.querySelectorAll('.packet');
            packets.forEach(packet => {
                const progress = config.animationStep / config.totalSteps;
                
                let content = '';
                if (progress < 0.5) {
                    content = 'REQ';
                    packet.style.background = 'linear-gradient(45deg, #3b82f6, #8b5cf6)';
                } else {
                    content = 'RES';
                    packet.style.background = 'linear-gradient(45deg, #10b981, #3b82f6)';
                }
                
                packet.textContent = content;
                
                // Ajouter info couche
                const layerInfo = document.createElement('div');
                layerInfo.className = 'packet-layer';
                layerInfo.textContent = `√âtape ${config.animationStep + 1}`;
                packet.appendChild(layerInfo);
            });
        }

        // SURBRILLER LES √âL√âMENTS
        function highlightElements(step) {
            // R√©initialiser tous les √©l√©ments
            const elements = document.querySelectorAll('.network-element');
            elements.forEach(el => el.classList.remove('active', 'bouncing'));
            
            // Activer les √©l√©ments en fonction de l'√©tape
            if (config.animationStep < 5) {
                document.getElementById('clientElement').classList.add('active');
            } else if (config.animationStep < 8) {
                document.getElementById('switchElement').classList.add('bouncing');
                document.getElementById('routerElement').classList.add('active');
            } else if (config.animationStep < 13) {
                document.getElementById('serverElement').classList.add('active');
            } else if (config.animationStep < 18) {
                document.getElementById('clientElement').classList.add('bouncing');
            }
        }

        // JOURNAL DE D√âBUG
        function logStep(step) {
            const terminal = document.getElementById('debugTerminal');
            const line = document.createElement('div');
            line.className = 'debug-line active';
            
            let direction = '';
            if (step.client) direction = '[CLIENT ‚Üí]';
            if (step.server) direction = '[‚Üê SERVEUR]';
            if (step.network) direction = '[‚Üî R√âSEAU]';
            
            line.textContent = `$ ${String(config.animationStep + 1).padStart(2, '0')} ${direction} ${step.name}: ${step.description}`;
            
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
            
            // D√©sactiver les anciennes lignes
            setTimeout(() => {
                line.classList.remove('active');
            }, 2000);
        }

        function logDebug(message) {
            const terminal = document.getElementById('debugTerminal');
            const line = document.createElement('div');
            line.className = 'debug-line';
            line.textContent = `$ ${message}`;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }

        // PAUSE
        function pauseAnimation() {
            if (!config.isPlaying) return;
            
            config.isPlaying = false;
            clearInterval(config.intervalId);
            
            document.querySelector('.btn-play').disabled = false;
            logDebug("‚è∏Ô∏è Animation en pause");
        }

        // R√âINITIALISER
        function resetAnimation() {
            pauseAnimation();
            
            config.animationStep = 0;
            config.isPlaying = false;
            
            // R√©initialiser l'interface
            document.getElementById('progressFill').style.width = '0%';
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.querySelectorAll('.timeline-step').forEach(step => step.classList.remove('active'));
            document.querySelectorAll('.network-element').forEach(el => el.classList.remove('active', 'bouncing'));
            document.querySelectorAll('.connection-line').forEach(line => line.classList.remove('active'));
            
            // R√©initialiser les paquets
            const packet1 = document.getElementById('packet1');
            const packet2 = document.getElementById('packet2');
            packet1.style.left = '300px';
            packet2.style.left = '300px';
            packet2.style.display = 'none';
            
            // R√©initialiser les couches
            document.querySelectorAll('.layer-content').forEach(content => {
                content.innerHTML = '<div class="data-chunk">En attente...</div>';
            });
            
            // R√©initialiser le terminal
            const terminal = document.getElementById('debugTerminal');
            terminal.innerHTML = `
                <div class="debug-line">$ Syst√®me r√©initialis√©...</div>
                <div class="debug-line">$ Pr√™t pour nouvelle simulation</div>
                <div class="debug-line">$ Cliquez "D√©marrer" pour lancer l'animation</div>
            `;
            
            document.querySelector('.btn-play').disabled = false;
            logDebug("üîÑ Simulation r√©initialis√©e");
        }

        // VITESSE
        function setSpeed(speed) {
            config.speed = speed;
            
            if (config.isPlaying) {
                pauseAnimation();
                startAnimation();
            }
            
            logDebug(`Vitesse r√©gl√©e sur: ${speed}`);
        }

        // TERMINER L'ANIMATION
        function completeAnimation() {
            pauseAnimation();
            logDebug("‚úÖ Transmission compl√©t√©e avec succ√®s!");
            
            // Animation de c√©l√©bration
            document.querySelectorAll('.network-element').forEach(el => {
                el.classList.add('active');
            });
            
            // Afficher message de succ√®s
            const terminal = document.getElementById('debugTerminal');
            const line = document.createElement('div');
            line.className = 'debug-line';
            line.style.color = '#10b981';
            line.style.fontWeight = 'bold';
            line.textContent = 'üéâ TRANSMISSION R√âUSSIE! La page web a √©t√© charg√©e.';
            terminal.appendChild(line);
        }

        // MODAL PAQUET
        function setupPacketClick() {
            document.querySelectorAll('.packet').forEach(packet => {
                packet.addEventListener('click', showPacketDetails);
            });
        }

        function showPacketDetails(event) {
            const modal = document.getElementById('packetModal');
            const details = document.getElementById('packetDetails');
            
            const progress = config.animationStep / config.totalSteps;
            let packetType = progress < 0.5 ? 'Requ√™te' : 'R√©ponse';
            
            details.innerHTML = `
                <h3>üì¶ Paquet ${packetType} - √âtape ${config.animationStep + 1}</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div>
                        <h4>üìä Informations</h4>
                        <div class="element-details">
                            Type: ${packetType}<br>
                            √âtape: ${config.animationStep + 1}/${config.totalSteps}<br>
                            Couche active: ${simulationData.steps[config.animationStep]?.layer || 'N/A'}<br>
                            Direction: ${progress < 0.5 ? 'Client ‚Üí Serveur' : 'Serveur ‚Üí Client'}
                        </div>
                    </div>
                    <div>
                        <h4>üìç Position</h4>
                        <div class="element-details">
                            X: ${event.target.style.left}<br>
                            Y: ${event.target.style.top}<br>
                            Vitesse: ${config.speed}<br>
                            Statut: ${config.isPlaying ? 'En mouvement' : 'Arr√™t√©'}
                        </div>
                    </div>
                </div>
                
                <h4>üèóÔ∏è Structure OSI du paquet:</h4>
                <div style="margin: 15px 0;">
                    ${Object.values(simulationData.packetStructure).map(layer => `
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 4px solid var(--layer${layer.layer});">
                            <strong>Couche ${layer.layer}:</strong> ${layer.data}<br>
                            <small>Taille: ${layer.size}</small>
                        </div>
                    `).join('')}
                </div>
                
                <h4>üéØ Filtres Wireshark associ√©s:</h4>
                <div class="element-details">
                    ${progress < 0.5 ? `
                    # Requ√™te HTTP<br>
                    http.request.method == "GET"<br>
                    ip.src == 192.168.1.100<br>
                    tcp.srcport == 49152
                    ` : `
                    # R√©ponse HTTP<br>
                    http.response.code == 200<br>
                    ip.dst == 192.168.1.100<br>
                    tcp.dstport == 49152
                    `}
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('packetModal').style.display = 'none';
        }

        // GESTION CLAVIER
        document.addEventListener('keydown', (event) => {
            switch(event.key) {
                case ' ':
                    event.preventDefault();
                    if (config.isPlaying) pauseAnimation();
                    else startAnimation();
                    break;
                case 'r':
                case 'R':
                    resetAnimation();
                    break;
                case '1':
                    setSpeed('slow');
                    break;
                case '2':
                    setSpeed('normal');
                    break;
                case '3':
                    setSpeed('fast');
                    break;
                case 'Escape':
                    closeModal();
                    break;
            }
        });

        // INITIALISATION AU CHARGEMENT
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>